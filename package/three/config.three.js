import{BufferGeometry,Points,PointsMaterial}from"three";import Stats from"three/examples/jsm/libs/stats.module";import{CAMERA,RENDERER,SCENE}from"./globals.three";import{particleSystemStringToNumber}from"./helpers.three";import{getOrbitControl}from"./orbitControl.three";export const ParticleSystemAnimation=function(e){e.container.appendChild(RENDERER.domElement);let t=void 0;e.stats&&(t=Stats(),e.container.appendChild(t.domElement));const o=getOrbitControl(CAMERA,RENDERER.domElement,e.orbitConfig);CAMERA.position.z=e.zoom?e.zoom:500;const i=new BufferGeometry,r=new PointsMaterial({transparent:!0,opacity:e.material.opacity||.7,size:e.material.sizeParticle,color:particleSystemStringToNumber(e.material.color)});e.system.setGeometry(i);const n=new Points(i,r);SCENE.add(n),e.system.setScene(SCENE);const a=()=>{CAMERA.aspect=window.innerWidth/window.innerHeight,CAMERA.updateProjectionMatrix(),RENDERER.setSize(window.innerWidth,window.innerHeight)};window.addEventListener("resize",a,!1);let s;const E=()=>{s=requestAnimationFrame(E),e.system.update(),(()=>{var t;(null===(t=e.orbitConfig)||void 0===t?void 0:t.autoRotate)&&(SCENE.rotateX(-90*Math.PI/180*.001),SCENE.rotateY(90*Math.PI/180*.001))})(),o.update(),i.attributes.position.needsUpdate=!0,RENDERER.render(SCENE,CAMERA),e.stats&&t.update()};return{start:E,stop:()=>{cancelAnimationFrame(s),n.geometry.dispose(),n.material.dispose(),o.dispose(),RENDERER.clear(),CAMERA.position.set(0,0,0),CAMERA.lookAt(0,0,0),CAMERA.clear(),SCENE.rotation.set(0,0,0),SCENE.remove(n),SCENE.remove(CAMERA),SCENE.clear(),e.system.dispose(),window.removeEventListener("resize",a,!1),console.info("stop animations")},changeColor:e=>{r.color.set(e)},changeOpacity:e=>{r.opacity=e},takePhoto:()=>{RENDERER.render(SCENE,CAMERA),RENDERER.domElement.toBlob(function(e){if(null!==e){var t=document.createElement("a"),o=URL.createObjectURL(e);t.href=o,t.download="particles.png",t.click()}},"image/png",1)}}};